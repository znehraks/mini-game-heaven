# AI Logging Configuration
# claude-symphony AI call verification and logging rules (Improvement suggestions #2, #3 resolution)

ai_logging:
  # Enable/disable
  enabled: true

  # Log storage location
  log_file: "state/ai_calls.log"

# Gemini call verification checklist (Improvement suggestion #2)
gemini_verification:
  # Pre-call checklist
  pre_call_checklist:
    - name: "cli_installed"
      check: "which gemini"
      description: "Verify Gemini CLI installation"

    - name: "wrapper_exists"
      check: "test -f scripts/gemini-wrapper.sh"
      description: "Verify wrapper script exists"

    - name: "prompt_file_ready"
      check: "test -f ${PROMPT_FILE}"
      description: "Verify prompt file is ready"

  # Post-call checklist
  post_call_checklist:
    - name: "tmux_session_active"
      check: "tmux has-session -t ax-gemini 2>/dev/null"
      description: "Verify tmux session is active"

    - name: "output_saved"
      check: "test -f outputs/${OUTPUT_FILE}"
      description: "Verify output file is saved"

# Codex call verification checklist
codex_verification:
  pre_call_checklist:
    - name: "cli_installed"
      check: "which codex"
      description: "Verify Codex CLI installation"

    - name: "wrapper_exists"
      check: "test -f scripts/codex-wrapper.sh"
      description: "Verify wrapper script exists"

    - name: "sandbox_ready"
      check: "docker ps | grep -q codex-sandbox || true"
      description: "Verify sandbox is ready (optional)"

  post_call_checklist:
    - name: "tmux_session_active"
      check: "tmux has-session -t ax-codex 2>/dev/null"
      description: "Verify tmux session is active"

    - name: "output_saved"
      check: "test -f outputs/${OUTPUT_FILE}"
      description: "Verify output file is saved"

# HANDOFF.md AI call log inclusion settings (Improvement suggestion #3)
handoff_ai_log:
  # Enable/disable
  enabled: true

  # Log table format
  format: |
    ## AI Call Log

    | AI | Call Time | Prompt File | Result File | Status |
    |----|-----------|-------------|-------------|--------|
    {{#each ai_calls}}
    | {{model}} | {{timestamp}} | {{prompt_file}} | {{output_file}} | {{status}} |
    {{/each}}

  # Information to include
  include:
    - model              # AI model name (Gemini, Codex, ClaudeCode)
    - timestamp          # Call time
    - prompt_file        # Prompt file path
    - output_file        # Output file path
    - status             # Success/failure
    - duration_seconds   # Execution time (optional)

# Stage-specific AI call tracking
stage_tracking:
  # Track AI calls per stage
  enabled: true

  # Tracking items
  track:
    - stage_id           # Stage ID
    - ai_model           # AI model used
    - call_count         # Number of calls
    - total_duration     # Total duration
    - success_rate       # Success rate

# Log format
log_format:
  # Single call log
  single_call: |
    [{{timestamp}}] {{stage_id}} - {{model}}
    Prompt: {{prompt_file}}
    Output: {{output_file}}
    Status: {{status}}
    Duration: {{duration}}s

  # Daily summary
  daily_summary: |
    === AI Call Daily Summary ({{date}}) ===
    Total Calls: {{total_calls}}
    Gemini: {{gemini_calls}}
    Codex: {{codex_calls}}
    ClaudeCode: {{claude_calls}}
    Success Rate: {{success_rate}}%

# Alert settings
alerts:
  # Alert on consecutive failures
  consecutive_failures:
    threshold: 3
    action: "notify_user"
    message: "AI calls have failed {{count}} times consecutively. Please check settings."

  # Slow response warning
  slow_response:
    threshold_seconds: 300
    action: "warn"
    message: "AI response exceeded {{threshold}} seconds."
