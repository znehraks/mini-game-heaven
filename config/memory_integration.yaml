# claude-symphony Memory Integration Configuration
# AI memory provider integration and sync settings

memory_integration:
  enabled: true
  description: "AI memory system integration and context synchronization"

  # Supported memory providers
  providers:
    claude_mem:
      enabled: true
      description: "Claude Memory MCP server integration"

      # Sync triggers
      sync_on:
        - "stage_complete"
        - "session_end"
        - "checkpoint_create"
        - "critical_decision"

      # Storage settings
      storage:
        project_prefix: "claude-symphony"
        observation_types:
          - "decision"
          - "discovery"
          - "feature"
          - "bugfix"

      # Search settings
      search:
        default_limit: 10
        include_timeline: true

    # Other providers for future extension
    external_memory:
      enabled: false
      provider: null

  # HANDOFF-memory synchronization
  handoff_memory_sync:
    on_stage_complete:
      - action: "save_to_memory"
        content: "key_decisions"
        observation_type: "decision"
        tags:
          - "{{stage_id}}"
          - "{{project_name}}"
        include_metadata:
          - stage
          - timestamp
          - related_files

      - action: "save_to_memory"
        content: "blocking_issues"
        observation_type: "bugfix"
        tags:
          - "issue"
          - "{{stage_id}}"

      - action: "save_to_memory"
        content: "technical_discoveries"
        observation_type: "discovery"
        tags:
          - "learning"
          - "{{stage_id}}"

    on_stage_start:
      - action: "load_from_memory"
        filter:
          project: "{{project_name}}"
          stages:
            - "{{previous_stage}}"
            - "{{current_stage}}"
          limit: 20
        inject_to: "context"
        format: "summary"

      - action: "search_related"
        query: "{{stage_objectives}}"
        limit: 5
        inject_to: "relevant_context"

    on_session_start:
      - action: "load_recent"
        project: "{{project_name}}"
        limit: 30
        days: 7
        inject_to: "session_context"

  # Context injection settings
  context_injection:
    enabled: true
    description: "Auto-inject relevant context from memory"

    triggers:
      on_task_start:
        enabled: true
        search_query: "{{task_description}}"
        max_results: 5
        inject_location: "task_context"

      on_error:
        enabled: true
        search_query: "error {{error_type}} {{error_message}}"
        max_results: 3
        inject_location: "debugging_hints"

    formatting:
      header: "## Related Context from Memory"
      item_template: |
        ### {{title}}
        - **Type**: {{type}}
        - **Stage**: {{stage}}
        - **Date**: {{date}}
        > {{content}}

  # Memory cleanup policy
  cleanup_policy:
    auto_cleanup: true

    retention:
      decisions: 90  # days
      discoveries: 180
      bugfixes: 60
      general: 30

    deduplication:
      enabled: true
      similarity_threshold: 0.85

# Session context recovery
session_recovery:
  enabled: true
  description: "Automatic previous session context recovery"

  on_session_start:
    auto_load: true
    prompt_user: false  # true to ask user for confirmation

    load_order:
      - last_handoff
      - recent_memories
      - checkpoint_state

  recovery_prompt:
    enabled: true
    template: |
      ## Previous Session Context Recovered

      **Last Stage**: {{last_stage}}
      **Last Task**: {{last_task}}
      **Status**: {{status}}

      ### Key Context
      {{key_context}}

      ### Next Steps
      {{next_steps}}

# Cross-stage learning
cross_stage_learning:
  enabled: true
  description: "Inter-stage learning and pattern recognition"

  patterns:
    track:
      - successful_approaches
      - failed_approaches
      - common_errors
      - time_estimates

    apply:
      suggest_similar: true
      warn_on_known_pitfalls: true

  feedback_loop:
    enabled: true
    collect_on: ["stage_complete", "task_complete"]
    metrics:
      - success_rate
      - time_taken
      - iterations_needed

# Integration verification
integration_checks:
  on_startup:
    - check_memory_connection
    - verify_project_access
    - load_configuration

  health_monitoring:
    enabled: true
    interval: 300  # 5 minutes
    alert_on_failure: true

  fallback:
    on_memory_unavailable: "local_cache"
    local_cache_path: "state/memory_cache/"
    cache_ttl: 3600  # 1 hour
