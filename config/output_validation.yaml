# claude-symphony Output Validation Configuration
# Stage output verification and quality assurance

validation:
  enabled: true
  description: "Per-stage output verification and quality assurance"

  # Per-stage validation rules
  per_stage:
    "01-brainstorm":
      description: "Ideas and requirements output validation"

      required_outputs:
        ideas.md:
          exists: true
          min_size_bytes: 500
          content_checks:
            min_ideas: 5
            has_sections: ["Idea List", "Evaluation Criteria"]

        requirements_analysis.md:
          exists: true
          min_size_bytes: 1000
          content_checks:
            sections:
              - "Functional Requirements"
              - "Non-Functional Requirements"
            has_priorities: true

      validation_commands: []

      quality_metrics:
        idea_diversity: 0.7  # Idea diversity score
        requirement_completeness: 0.8

    "02-research":
      description: "Research output validation"

      required_outputs:
        tech_research.md:
          exists: true
          min_size_bytes: 2000
          content_checks:
            has_sources: true
            min_sources: 3

        feasibility_report.md:
          exists: true
          content_checks:
            sections:
              - "Technical Feasibility"
              - "Risk Analysis"
              - "Conclusion"

      validation_commands: []

      quality_metrics:
        source_quality: 0.8
        analysis_depth: 0.7

    "03-planning":
      description: "Planning output validation"

      required_outputs:
        architecture.md:
          exists: true
          min_size_bytes: 2000
          content_checks:
            has_diagrams: true
            sections:
              - "System Architecture"
              - "Component Design"
              - "Data Flow"

        tech_stack.md:
          exists: true
          content_checks:
            has_justification: true

        project_plan.md:
          exists: true
          content_checks:
            has_timeline: true
            has_milestones: true

      validation_commands: []

    "04-ui-ux":
      description: "UI/UX design output validation"

      required_outputs:
        wireframes.md:
          exists: true
          content_checks:
            min_screens: 3

        user_flows.md:
          exists: true
          content_checks:
            has_flow_diagram: true

        design_system.md:
          exists: true
          content_checks:
            sections:
              - "Colors"
              - "Typography"
              - "Components"

      validation_commands: []

    "05-task-management":
      description: "Task management output validation"

      required_outputs:
        tasks.md:
          exists: true
          content_checks:
            min_tasks: 10
            has_estimates: true
            has_priorities: true

        sprint_plan.md:
          exists: true
          content_checks:
            has_sprint_goals: true

      validation_commands: []

    "06-implementation":
      description: "Implementation output validation"

      required_outputs:
        "source_code/":
          exists: true
          is_directory: true

        implementation_log.md:
          exists: true
          format: "changelog"

      validation_commands:
        - name: "lint"
          command: "npm run lint"
          required: true
          allow_warnings: true

        - name: "typecheck"
          command: "npm run typecheck"
          required: true

        - name: "build"
          command: "npm run build"
          required: true

      quality_metrics:
        lint_score: 0.9
        type_coverage: 0.95

      # Notion Task Status Validation (ISSUE-005)
      notion_validation:
        enabled: true
        description: "Enforce Notion task status updates on task completion"

        on_task_complete:
          required_status: "Done"
          block_on_failure: true
          error_message: "❌ Task not marked as Done in Notion. Update before proceeding."

        on_sprint_complete:
          all_tasks_done: true
          block_stage_transition: true
          error_message: "❌ Sprint has incomplete tasks in Notion. All tasks must be Done."

        on_stage_transition:
          all_sprint_tasks_done: true
          validation_command: "notion-check-sprint-status"
          block_on_failure: true

    "07-refactoring":
      description: "Refactoring output validation"

      required_outputs:
        "refactored_code/":
          exists: true
          is_directory: true

        refactoring_report.md:
          exists: true
          content_checks:
            sections:
              - "Changes"
              - "Improvements"
              - "Performance Comparison"

      validation_commands:
        - name: "lint"
          command: "npm run lint"
          required: true

        - name: "test"
          command: "npm run test"
          required: true

      quality_metrics:
        complexity_improvement: true
        no_regression: true

    "08-qa":
      description: "QA output validation"

      required_outputs:
        qa_report.md:
          exists: true
          content_checks:
            sections:
              - "Issues Found"
              - "Issues Resolved"
              - "Quality Assessment"

        bug_fixes.md:
          exists: true
          content_checks:
            has_bug_list: true

      validation_commands:
        - name: "lint"
          command: "npm run lint"
          required: true

        - name: "test"
          command: "npm run test"
          required: true

      quality_metrics:
        bug_resolution_rate: 0.9

    "09-testing":
      description: "Testing output validation"

      required_outputs:
        "tests/":
          exists: true
          is_directory: true

        test_report.md:
          exists: true
          content_checks:
            pass_rate_min: 100

        coverage_report.md:
          exists: true
          content_checks:
            coverage_min: 80

      validation_commands:
        - name: "test"
          command: "npm run test"
          required: true

        - name: "coverage"
          command: "npm run test:coverage"
          required: true
          threshold:
            lines: 80
            branches: 75
            functions: 80

      quality_metrics:
        test_coverage: 0.8
        all_tests_pass: true

    "10-deployment":
      description: "Deployment output validation"

      required_outputs:
        ".github/workflows/":
          exists: true
          is_directory: true

        "deployment_config/":
          exists: true
          is_directory: true

        deployment_log.md:
          exists: true

      validation_commands:
        - name: "workflow_validate"
          command: "gh workflow list"
          required: false

      quality_metrics:
        ci_configured: true
        deployment_documented: true

# Validation process
validation_process:
  steps:
    - name: "check_required_files"
      description: "Check required files exist"
      required: true

    - name: "validate_file_content"
      description: "Validate file content"
      required: true

    - name: "run_validation_commands"
      description: "Run validation commands"
      required: false

    - name: "calculate_quality_score"
      description: "Calculate quality score"
      required: false

    - name: "generate_report"
      description: "Generate validation report"
      required: true

  on_failure:
    action: "block_transition"
    allow_override: true
    require_justification: true

# Report settings
reporting:
  format: "markdown"
  output_path: "state/validations/"

  include:
    - validation_summary
    - file_checks
    - command_results
    - quality_scores
    - recommendations

  severity_levels:
    error:
      description: "Block stage transition"
      icon: "❌"
    warning:
      description: "Show warning only"
      icon: "⚠️"
    info:
      description: "Informational"
      icon: "ℹ️"
    pass:
      description: "Validation passed"
      icon: "✅"

# Auto-fix suggestions
auto_fix:
  enabled: true
  suggest_fixes: true
  auto_apply: false

  fixable_issues:
    - missing_sections
    - format_errors
    - lint_errors

# Integration settings
integration:
  handoff:
    include_validation_status: true
    block_if_failed: true

  checkpoint:
    save_validation_results: true

  memory:
    save_quality_trends: true
