# Stage 07: Refactoring Configuration

stage:
  id: "07-refactoring"
  name: "Refactoring"
  description: "Code quality improvement and optimization"

models:
  primary: "codex"
  secondary: "claudecode"
  collaboration: "sequential"

# AI auto-invoke settings (Issue #12, #14 resolution)
auto_invoke:
  enabled: true
  model: "codex"
  trigger: "refactoring_start"
  prompt_file: "prompts/code_analysis.md"
  wrapper: "scripts/codex-wrapper.sh"
  flags: "--full-auto"
  required: true
  message: "ðŸ¤– Codex auto-invoke: Starting code analysis and refactoring"

execution:
  mode: "deep_dive"
  container: false
  sandbox: false
  timeout: 7200  # 2 hours

inputs:
  required:
    - name: "../06-implementation/outputs/source_code/"
    - name: "../06-implementation/outputs/implementation_log.md"
    - name: "../06-implementation/HANDOFF.md"

outputs:
  required:
    - name: "refactored_code/"
      description: "Refactored code"
    - name: "refactoring_report.md"
      description: "Refactoring report"
    - name: "HANDOFF.md"

prompts:
  - name: "code_analysis"
    file: "prompts/code_analysis.md"
    model: "codex"
  - name: "refactoring"
    file: "prompts/refactoring.md"
    model: "codex"
  - name: "optimization"
    file: "prompts/optimization.md"
    model: "codex"

completion:
  checklist:
    - "Code quality analysis complete"
    - "Duplicate code removed"
    - "Performance optimization applied"
    - "Refactoring report written"
    - "Checkpoint created"

transition:
  next_stage: "08-qa"
  prerequisites:
    - "06-implementation"
  handoff_required: true
  checkpoint_required: true  # Required!
